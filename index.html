<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPG Pairing Dashboard</title>
    <link rel="icon" href="https://raw.githubusercontent.com/tkdbrad03/fpg-scorekeeper/main/fpg-logo.png" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }
        
        .header {
            background: linear-gradient(135deg, #3c763d 0%, #2d5a2e 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header .logo {
            display: block;
            margin: 0 auto 0.75rem auto;
            height: 80px;
            max-width: 100%;
            width: auto;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .header .tagline {
            color: #e6b800;
            font-size: 1rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .top-bar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .stats {
            display: flex;
            gap: 2rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3c763d;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6c757d;
            text-transform: uppercase;
        }
        
        .actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3c763d;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2d5a2e;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: white;
            color: #3c763d;
            border: 2px solid #3c763d;
        }
        
        .btn-gold {
            background: #e6b800;
            color: #000;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #3c763d;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .player-pool {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .player-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s;
        }
        
        .player-item:hover {
            border-color: #3c763d;
            box-shadow: 0 2px 8px rgba(60, 118, 61, 0.2);
        }
        
        .player-item.dragging {
            opacity: 0.5;
        }
        
        .player-name {
            font-weight: bold;
            color: #2d5a2e;
            margin-bottom: 0.25rem;
        }
        
        .player-prefs {
            font-size: 0.75rem;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .pref-tag {
            background: #d4edda;
            color: #2d5a2e;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .scorekeeper-badge {
            background: #3c763d;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .groups-container {
            display: grid;
            gap: 1.5rem;
        }
        
        .group-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.2s;
        }
        
        .group-card.complete {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .group-card.incomplete {
            border-color: #ffc107;
            background: #fffdf5;
        }
        
        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #dee2e6;
        }
        
        .group-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #2d5a2e;
        }
        
        .group-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
        }
        
        .status-complete {
            color: #28a745;
        }
        
        .status-incomplete {
            color: #ffc107;
        }
        
        .drop-zone {
            min-height: 200px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .drop-zone.drag-over {
            border-color: #3c763d;
            background: #d4edda;
        }
        
        .drop-zone-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: #6c757d;
            font-style: italic;
        }
        
        .group-players {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .group-player {
            background: #f8f9fa;
            border: 2px solid #3c763d;
            border-radius: 8px;
            padding: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .remove-btn:hover {
            background: #c82333;
        }
        
        .scorekeeper-selector {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #dee2e6;
        }
        
        .scorekeeper-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .scorekeeper-row label {
            font-weight: 600;
            color: #2d5a2e;
            min-width: 100px;
        }
        
        .scorekeeper-row select {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #3c763d;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .add-group-btn {
            width: 100%;
            padding: 1.5rem;
            border: 2px dashed #3c763d;
            background: #f8fff9;
            color: #3c763d;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .add-group-btn:hover {
            background: #d4edda;
            transform: translateY(-2px);
        }
        
        .suggestions {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .suggestions h3 {
            color: #856404;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        
        .suggestion-item {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .suggestion-item:hover {
            background: #3c763d;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-header h2 {
            color: #3c763d;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6c757d;
        }
        
        .preview-group {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .preview-group h3 {
            color: #2d5a2e;
            margin-bottom: 0.75rem;
        }
        
        .preview-player {
            padding: 0.5rem;
            border-left: 3px solid #3c763d;
            margin-bottom: 0.25rem;
        }

       
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img class="logo" src="https://raw.githubusercontent.com/tkdbrad03/fpg-scorekeeper/main/fpg-logo.png" alt="FPG Logo" />
        <h1>FPG Pairing Dashboard</h1>
        <p class="tagline">Thursday Pairing Assistant - Good Golf • Good Friends • Good Times</p>
    </div>

    

        <div class="top-bar">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="total-players">0</div>
                    <div class="stat-label">Checked In</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="total-groups">0</div>
                    <div class="stat-label">Groups Created</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="unassigned-count">0</div>
                    <div class="stat-label">Unassigned</div>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" onclick="loadCheckIns()">Refresh Check-Ins</button>
                <input 
                    type="time" 
                    id="start-time" 
                    value="09:00" 
                    style="padding: 0.5rem; border: 2px solid #3c763d; border-radius: 6px; font-weight: 600;"
                />
                <button class="btn btn-gold" onclick="autoSuggest()">Smart Suggestions</button>
                <button class="btn btn-primary" onclick="previewPairings()">Preview</button>
                <button class="btn btn-primary" onclick="publishPairings()" style="background-color:#00733e;">
                    Publish Pairings
                </button>
            </div>
        </div>

        <div class="main-grid">
            <!-- Left Sidebar: Available Players -->
            <div>
                <div class="card">
                    <h2>Available Players</h2>
                    <div class="player-pool" id="player-pool">
                        <!-- Players will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Right Side: Groups -->
            <div>
                <div class="suggestions" id="suggestions-box" style="display: none;">
                    <h3>Smart Suggestions</h3>
                    <div id="suggestions-list"></div>
                </div>

                <div class="groups-container" id="groups-container">
                    <!-- Groups will be created here -->
                </div>

                <button class="add-group-btn" onclick="addNewGroup()">
                    Add New Group
                </button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal" id="preview-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Pairings Preview</h2>
                <button class="close-btn" onclick="closeModal('preview-modal')">&times;</button>
            </div>
            <div id="preview-content"></div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="closeModal('preview-modal')" style="flex: 1;">Close</button>
            </div>
        </div>
    </div>

    <script>
        
        const JSONBIN_ID = "68f5ade543b1c97be97289ff";  // ← PUT YOUR BIN ID HERE
        const JSONBIN_MASTER_KEY = "$2a$10$vLlrbMJiT/pA18r.TWPkp.GmyzD/YJ/ghsjZWGKgzNY6YmAV6OT7m";
        
        // Once configured, you can remove the setup notice by uncommenting:
        // document.getElementById('setup-notice').style.display = 'none';
        // ========================================

        let players = [];
        let groups = [];
        let groupCounter = 0;
        let unassignedPlayers = [];

        async function fetchCheckIns() {
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS6XoBTQryAiLHQzKVboT3zij3gekRO0ywjtEg6DGhgjkFzlkEdBe22RZ-f_1TZrs-qewzAWBipaG_B/pub?output=csv';
            const response = await fetch(sheetUrl);
            const text = await response.text();

            function parseCSV(text) {
                const lines = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n").split("\n");
                const table = [];
                for (const line of lines) {
                    if (line === "" && table.length > 0) continue;
                    const row = [];
                    let cur = "";
                    let q = false;
                    for (let i = 0; i < line.length; i++) {
                        const ch = line[i];
                        if (ch === '"') {
                            if (q && line[i + 1] === '"') { cur += '"'; i++; }
                            else { q = !q; }
                        } else if (ch === "," && !q) {
                            row.push(cur);
                            cur = "";
                        } else {
                            cur += ch;
                        }
                    }
                    row.push(cur);
                    table.push(row.map(v => v.trim()));
                }
                return table;
            }

            const table = parseCSV(text);
            if (!table.length) return;

            const headers = table[0].map(h => h.trim());
            const nameIndex = headers.indexOf('Player Name *') !== -1
                ? headers.indexOf('Player Name *')
                : headers.indexOf('Player Name');
            const prefIndex = headers.indexOf('Pairing Requests') !== -1
                ? headers.indexOf('Pairing Requests')
                : headers.indexOf('Pairing Request');
            const notesIndex = headers.indexOf('Notes');
            const eventIndex = headers.indexOf('Event');

            const rows = table.slice(1).filter(r => r.length && r[nameIndex]);
            const today = new Date();
            today.setHours(0,0,0,0);

            function extractEventDate(ev) {
                const m = (ev || "").match(/(?:,\s*)?([A-Za-z]+)\s+(\d{1,2})(?:,\s*(\d{4}))?$/);
                if (!m) return null;
                const [, mon, day, yr] = m;
                const y = yr ? parseInt(yr,10) : today.getFullYear();
                const d = new Date(`${mon} ${day}, ${y}`);
                if (isNaN(d)) return null;
                d.setHours(0,0,0,0);
                return d;
            }

            const upcoming = [];
            for (const r of rows) {
                const ev = eventIndex !== -1 ? r[eventIndex] : "";
                const d = extractEventDate(ev);
                if (d && d >= today) upcoming.push({ r, d });
            }

            const source = upcoming.length ? (() => {
                const minTime = Math.min(...upcoming.map(x => x.d.getTime()));
                return upcoming.filter(x => x.d.getTime() === minTime).map(x => x.r);
            })() : rows;

            players = source.map(r => ({
                name: (r[nameIndex] || '').trim(),
                preferences: (prefIndex !== -1 && r[prefIndex])
                    ? r[prefIndex].split(',').map(p => p.trim()).filter(Boolean)
                    : [],
                canScorekeep: true,
                notes: (notesIndex !== -1 ? (r[notesIndex] || '').trim() : '')
            }));

            unassignedPlayers = [...players];
            renderPlayerPool();
            updateStats();
        }

        async function loadCheckIns() {
            await fetchCheckIns();
            alert('Loaded live check-ins from Google Sheet!');
        }

        function renderPlayerPool() {
            const pool = document.getElementById('player-pool');
            pool.innerHTML = '';

            unassignedPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.draggable = true;
                div.dataset.playerIndex = index;
                
                div.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-prefs">
                        ${player.canScorekeep ? '<span class="scorekeeper-badge">SCOREKEEPER</span>' : ''}
                        ${player.preferences.length > 0 ? 
                            player.preferences.map(p => `<span class="pref-tag">Wants: ${p.split(' ')[0]}</span>`).join('') : 
                            '<span style="color: #6c757d;">No preferences</span>'
                        }
                    </div>
                `;

                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);

                pool.appendChild(div);
            });
        }

        function handleDragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.dataset.playerIndex);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function addNewGroup() {
            const teeTime = calculateTeeTime(groups.length);
            const group = {
                id: ++groupCounter,
                name: `Group ${groups.length + 1}`,
                teeTime: teeTime,
                players: [],
                keeper1: null,
                keeper2: null
            };
            groups.push(group);
            renderGroups();
            updateStats();
        }

        function calculateTeeTime(groupIndex) {
            const input = document.getElementById('start-time');
            const [inputHour, inputMinute] = input.value.split(':').map(Number);
            const interval = 8;
            const startTime = (inputHour * 60) + inputMinute;
            const time = startTime + (groupIndex * interval);
            
            let hours = Math.floor(time / 60);
            let minutes = time % 60;
            const suffix = hours >= 12 ? 'PM' : 'AM';
            if (hours > 12) hours -= 12;
            if (hours === 0) hours = 12;
            return `${hours}:${minutes.toString().padStart(2, '0')} ${suffix}`;
        }

        function renderGroups() {
            const container = document.getElementById('groups-container');
            container.innerHTML = '';

            groups.forEach((group, groupIndex) => {
                const div = document.createElement('div');
                div.className = `group-card ${group.players.length === 4 ? 'complete' : 'incomplete'}`;
                
                div.innerHTML = `
                    <div class="group-header">
                        <div class="group-title">${group.name} - ${group.teeTime}</div>
                        <div class="group-status ${group.players.length === 4 ? 'status-complete' : 'status-incomplete'}">
                            ${group.players.length === 4 ? 'Complete' : 'Incomplete'} • ${group.players.length}/4 Players
                        </div>
                    </div>
                    
                    <div class="drop-zone" data-group-index="${groupIndex}">
                        ${group.players.length > 0 ? `
                            <div class="group-players">
                                ${group.players.map((p, i) => `
                                    <div class="group-player">
                                        <div>
                                            <div style="font-weight: bold;">${p.name}</div>
                                            ${p.canScorekeep ? '<div style="font-size: 0.75rem; color: #3c763d;">Can scorekeep</div>' : ''}
                                        </div>
                                        <button class="remove-btn" onclick="removePlayer(${groupIndex}, ${i})">×</button>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<div class="drop-zone-empty">Drop players here or click "Smart Suggestions"</div>'}
                    </div>

                    ${group.players.length >= 2 ? `
                        <div class="scorekeeper-selector">
                            <div class="scorekeeper-row">
                                <label>Scorekeeper 1:</label>
                                <select onchange="setScorekeeper(${groupIndex}, 0, this.value)">
                                    <option value="">Select...</option>
                                    ${group.players.map((p, i) => 
                                        p.canScorekeep ? `<option value="${i}" ${group.keeper1 === i ? 'selected' : ''}>${p.name}</option>` : ''
                                    ).join('')}
                                </select>
                            </div>
                            <div class="scorekeeper-row">
                                <label>Scorekeeper 2:</label>
                                <select onchange="setScorekeeper(${groupIndex}, 1, this.value)">
                                    <option value="">Select...</option>
                                    ${group.players.map((p, i) => 
                                        p.canScorekeep && i !== group.keeper1 ? `<option value="${i}" ${group.keeper2 === i ? 'selected' : ''}>${p.name}</option>` : ''
                                    ).join('')}
                                </select>
                            </div>
                        </div>
                    ` : ''}
                `;

                container.appendChild(div);
            });

            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const playerIndex = parseInt(e.dataTransfer.getData('text/plain'));
            const groupIndex = parseInt(e.currentTarget.dataset.groupIndex);
            
            const group = groups[groupIndex];
            if (group.players.length < 4) {
                const player = unassignedPlayers[playerIndex];
                group.players.push(player);
                unassignedPlayers.splice(playerIndex, 1);
                
                renderPlayerPool();
                renderGroups();
                updateStats();
            } else {
                alert('This group is already full (4 players)');
            }
        }

        function removePlayer(groupIndex, playerIndex) {
            const group = groups[groupIndex];
            const player = group.players[playerIndex];
            
            unassignedPlayers.push(player);
            group.players.splice(playerIndex, 1);
            
            if (group.keeper1 === playerIndex) group.keeper1 = null;
            if (group.keeper2 === playerIndex) group.keeper2 = null;
            if (group.keeper1 > playerIndex) group.keeper1--;
            if (group.keeper2 > playerIndex) group.keeper2--;
            
            renderPlayerPool();
            renderGroups();
            updateStats();
        }

        function setScorekeeper(groupIndex, keeperNum, playerIndex) {
            const group = groups[groupIndex];
            if (keeperNum === 0) {
                group.keeper1 = playerIndex === "" ? null : parseInt(playerIndex);
            } else {
                group.keeper2 = playerIndex === "" ? null : parseInt(playerIndex);
            }
            renderGroups();
        }

        function updateStats() {
            document.getElementById('total-players').textContent = players.length;
            document.getElementById('total-groups').textContent = groups.length;
            document.getElementById('unassigned-count').textContent = unassignedPlayers.length;
        }

        function autoSuggest() {
            const suggestionsBox = document.getElementById('suggestions-box');
            const suggestionsList = document.getElementById('suggestions-list');
            
            const suggestions = [];
            
            for (let i = 0; i < unassignedPlayers.length; i++) {
                const p1 = unassignedPlayers[i];
                for (let j = i + 1; j < unassignedPlayers.length; j++) {
                    const p2 = unassignedPlayers[j];
                    
                    if (p1.preferences.includes(p2.name) || p2.preferences.includes(p1.name)) {
                        suggestions.push({
                            players: [p1, p2],
                            score: (p1.preferences.includes(p2.name) ? 1 : 0) + (p2.preferences.includes(p1.name) ? 1 : 0)
                        });
                    }
                }
            }
            
            if (suggestions.length > 0) {
                suggestionsList.innerHTML = suggestions
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 5)
                    .map((s) => {
                        const idxs = s.players.map(p => unassignedPlayers.indexOf(p)).join(',');
                        const label = s.players.map(p => p.name).join(' + ');
                        const note = s.score === 2 ? '(Mutual preference)' : '(One-way preference)';
                        return `<div class="suggestion-item" onclick="createSuggestedGroup([${idxs}])">${label} ${note}</div>`;
                    }).join('');
                
                suggestionsBox.style.display = 'block';
            } else {
                alert('No strong preferences found. Try manual pairing!');
            }
        }

        function createSuggestedGroup(playerIndices) {
            addNewGroup();
            const group = groups[groups.length - 1];
            
            playerIndices.forEach(idx => {
                const player = unassignedPlayers[idx];
                group.players.push(player);
            });
            
            playerIndices.sort((a, b) => b - a).forEach(idx => {
                unassignedPlayers.splice(idx, 1);
            });
            
            renderPlayerPool();
            renderGroups();
            updateStats();
            document.getElementById('suggestions-box').style.display = 'none';
        }

        function previewPairings() {
            const preview = document.getElementById('preview-content');
            let html = '';
            
            groups.forEach((group) => {
                const keeper1 = group.keeper1 !== null ? group.players[group.keeper1].name : 'Not assigned';
                const keeper2 = group.keeper2 !== null ? group.players[group.keeper2].name : 'Not assigned';
                
                html += `
                    <div class="preview-group">
                        <h3>${group.name} - ${group.teeTime}</h3>
                        ${group.players.map((p, idx) => `
                            <div class="preview-player">
                                ${p.name}
                                ${idx === group.keeper1 ? ' (Scorekeeper 1)' : ''}
                                ${idx === group.keeper2 ? ' (Scorekeeper 2)' : ''}
                            </div>
                        `).join('')}
                        <div style="font-size:0.85rem;color:#2d5a2e;margin-top:0.25rem;">
                            Scorekeepers: ${keeper1}${keeper2 ? ' & ' + keeper2 : ''}
                        </div>
                    </div>
                `;
            });
            
            if (unassignedPlayers.length > 0) {
                html += `
                    <div class="preview-group" style="background: #fff3cd; border: 2px solid #ffc107;">
                        <h3 style="color: #856404;">Unassigned Players</h3>
                        ${unassignedPlayers.map(p => `<div class="preview-player">${p.name}</div>`).join('')}
                    </div>
                `;
            }
            
            preview.innerHTML = html;
            document.getElementById('preview-modal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function publishPairings() {

            if (groups.length === 0) {
                alert('⚠️ No groups created yet! Create some pairings first.');
                return;
            }

            // Format pairings data
            const pairingsData = groups.map((g, index) => ({
                groupNumber: index + 1,
                teeTime: g.teeTime,
                players: g.players.map(p => p.name),
                scorekeepers: [
                    g.keeper1 !== null ? g.players[g.keeper1].name : null,
                    g.keeper2 !== null ? g.players[g.keeper2].name : null
                ].filter(k => k !== null)
            }));

            try {
                // Publish to JSONBin
                // Publish to FPG API
const response = await fetch('https://fpg.complitrst.com/api/publish-pairings', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        date: new Date().toLocaleDateString('en-US'),
        course: 'TBD', // You can make this dynamic if needed
        groups: pairingsData
    })
});

                if (response.ok) {
                    alert('✅ Pairings published to FPG!\n\nPlayers can now see their groups at fpg.complitrst.com/pairings');
                } else {
                    alert('⚠️ Failed to publish. Please check your Bin ID and try again.');
                }
            } catch (error) {
                alert('❌ Error publishing pairings: ' + error.message);
            }
        }

        // Initialize with live data
        loadCheckIns();
    </script>
</body>
</html>
